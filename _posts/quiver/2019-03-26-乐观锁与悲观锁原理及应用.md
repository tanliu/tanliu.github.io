---
layout: post
title: 乐观锁与悲观锁原理及应用
date: 2019-03-26
tags:
   - 高并发
   - java
---
##乐观锁
> 不会对资源上锁。但是在更新时会判断其他线程在这之前有没有对数据进行修改，一般会使用**版本号机制**或**CAS操作**实现。

- 版本号
```
update table set x=x+1, version=version+1 where id=#{id} and version=#{version};
```
- CAS（ compare and set）
 更新版本不成功，不断重试真到成功

### 优点
- 不会产生死锁
- 不用给资源加锁，提高性能
### 不足
- 如果机器同时拿到同一资源的话，会不断重试。

## 悲观锁
> 总是假设最坏的情，当其他线程想要访问数据时，都需要阻塞挂起。可以依靠数据库实现，如行锁、读锁和写锁等，都是在操作之前加锁，在Java中，synchronized的思想也是悲观锁。

- 读锁、写锁、行锁等
- synchronized
  
## 应用

乐观锁：写比较少的情况下。冲突比较少的时候
悲观锁：冲突比较多的时候

